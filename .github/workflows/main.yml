name: Sync Fork

on:
  schedule:
    - cron: "0 0 * * *" # 매일 00:00 UTC에 실행
  workflow_dispatch: # 수동 실행 가능

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Fork
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # 전체 히스토리 가져오기
        submodules: false  # 서브모듈 완전 비활성화
        clean: true  # 이전 작업 내용 삭제
        persist-credentials: false  # 인증 캐시 사용 안 함

    - name: Disable Submodule Warnings
      run: |
        rm -rf .git/modules/Algorithm-Study  # 서브모듈 캐시 삭제
        git config --local --remove-section submodule || true  # 서브모듈 설정 제거
        git submodule deinit --all --force || true  # 서브모듈 비활성화
        git submodule foreach --recursive git rm --cached . || true  # 캐시된 서브모듈 제거

    - name: Configure Git User
      run: |
        git config --global user.name "jdoeun"
        git config --global user.email "jde429@khu.ac.kr"

    - name: Configure Git Safe Directory
      run: |
        git config --global --add safe.directory /home/runner/work/Algorithm-Study/Algorithm-Study

    - name: Set Upstream
      run: |
        git remote add upstream https://github.com/iceprins/Algorithm-Study.git
        git fetch upstream
        git checkout main || git checkout -b main
        git merge upstream/main --no-edit || true

    - name: Push Changes to Fork
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git push origin main || true

